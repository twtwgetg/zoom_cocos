# 天气效果扩展说明

## 功能描述
扩展天气效果系统，使其能够同时影响主背景([spr_bg](file:///c:/Users/Administrator/zoom_cocos/client/main/assets/script/frm_main.ts#L46-L46))和第二个背景([spr_bg2](file:///c:/Users/Administrator/zoom_cocos/client/main/assets/script/frm_main.ts#L47-L47))精灵。

## 实现原理

### 核心逻辑
1. 修改[WeatherShaderManager](file:///c:/Users/Administrator/zoom_cocos/client/main/assets/script/WeatherShaderManager.ts#L6-L6)类，添加对第二个背景精灵的支持
2. 在激活天气效果时，同时为两个背景精灵应用天气材质
3. 在取消天气效果时，同时恢复两个背景精灵的原始材质
4. 修改[setWeatherColor](file:///c:/Users/Administrator/zoom_cocos/client/main/assets/script/frm_main.ts#L527-L544)方法，使其也能为[spr_bg2](file:///c:/Users/Administrator/zoom_cocos/client/main/assets/script/frm_main.ts#L47-L47)设置颜色

### 代码实现

#### WeatherShaderManager.ts
- 添加了[backgroundSprite2](file:///c:/Users/Administrator/zoom_cocos/client/main/assets/script/WeatherShaderManager.ts#L12-L12)属性用于引用第二个背景精灵
- 在[initShaderSystem](file:///c:/Users/Administrator/zoom_cocos/client/main/assets/script/WeatherShaderManager.ts#L23-L44)方法中保存第二个背景精灵的原始材质
- 在[activateWeatherEffect](file:///c:/Users/Administrator/zoom_cocos/client/main/assets/script/WeatherShaderManager.ts#L76-L111)方法中同时为两个背景精灵应用天气材质
- 在[deactivateWeatherEffect](file:///c:/Users/Administrator/zoom_cocos/client/main/assets/script/WeatherShaderManager.ts#L115-L128)方法中平滑过渡回正常状态
- 在[resetWeatherEffect](file:///c:/Users/Administrator/zoom_cocos/client/main/assets/script/WeatherShaderManager.ts#L132-L151)方法中同时恢复两个背景精灵的原始材质

#### frm_main.ts
- 修改了[setWeatherColor](file:///c:/Users/Administrator/zoom_cocos/client/main/assets/script/frm_main.ts#L527-L544)方法，使其也能为[spr_bg2](file:///c:/Users/Administrator/zoom_cocos/client/main/assets/script/frm_main.ts#L47-L47)设置颜色
- 添加了对[spr_bg2](file:///c:/Users/Administrator/zoom_cocos/client/main/assets/script/frm_main.ts#L47-L47)存在性的检查，确保兼容性

## 技术细节

### 材质管理
- 保存两个背景精灵的原始材质，确保可以正确恢复
- 天气效果激活时，为两个背景精灵都应用相同的天气材质
- 天气效果取消时，为两个背景精灵都恢复原始材质

### 颜色动画
- 为两个背景精灵创建独立的颜色渐变动画
- 使用相同的持续时间和缓动函数确保视觉一致性
- 添加了对[spr_bg2](file:///c:/Users/Administrator/zoom_cocos/client/main/assets/script/frm_main.ts#L47-L47)存在性的检查，确保向后兼容

## 用户体验
这个功能提升了游戏的视觉一致性：
- 天气效果能够同时影响所有相关的背景元素
- 提供更沉浸式的游戏体验
- 保持了原有的天气过渡动画效果
- 确保两个背景元素的颜色变化同步