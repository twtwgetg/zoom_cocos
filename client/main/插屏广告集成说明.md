# 插屏广告集成说明

## 概述
已为您的 Cocos 项目创建了字节跳动插屏广告管理器 `InterstitialAdManager.ts`，该组件会在游戏结束时（胜利或失败）自动显示插屏广告。

## 功能特点
- 自动在游戏胜利(`game_win`)和游戏失败(`game_lose`)时显示插屏广告
- 使用您提供的广告位ID：`10ikr1q7pg73885i42`
- 自动处理广告加载、显示失败重试机制
- 防重复显示逻辑
- 完整的生命周期管理

## 集成步骤

### 步骤1：在 Cocos Creator 中添加组件
1. 打开 Cocos Creator
2. 在场景中找到一个合适的节点（建议在场景根节点或UI管理节点）
3. 在该节点上添加 `InterstitialAdManager` 组件：
   - 选择节点 → 属性检查器 → 添加组件 → 搜索 "InterstitialAdManager"
   - 或者直接拖拽 `InterstitialAdManager.ts` 文件到节点上

### 步骤2：确认广告位ID
- 组件的广告位ID已经设置为 `10ikr1q7pg73885i42`
- 如需修改，可在属性检查器中修改 `adUnitId` 字段

### 步骤3：测试验证
1. 构建项目到字节跳动小程序
2. 进行游戏测试，完成或失败关卡时应该会显示插屏广告

## 代码说明

### 主要功能
```typescript
// 监听游戏结束事件
Main.RegistEvent("game_win", (x) => {
    this.showInterstitialAd(); // 游戏胜利时显示插屏广告
});

Main.RegistEvent("game_lose", (x) => {
    this.showInterstitialAd(); // 游戏失败时显示插屏广告
});
```

### 广告加载机制
- 组件启动时自动加载广告
- 广告显示后自动重新加载，准备下次显示
- 加载失败时会在30秒后自动重试

### 防重复显示
- 通过 `isAdShowing` 标志防止广告重复显示
- 确保用户体验流畅

## 注意事项

1. **环境检测**：组件会自动检测是否在字节跳动环境，非字节跳动环境不会加载广告

2. **广告频率**：目前设置为每次游戏结束都显示，如需控制频率可以添加额外逻辑

3. **错误处理**：所有广告相关错误都会在控制台输出日志，便于调试

4. **性能优化**：广告实例在组件销毁时会自动清理

## 可选优化

### 添加显示频率控制
如果您希望控制广告显示频率（比如每3次游戏结束显示一次），可以在组件中添加计数逻辑：

```typescript
private gameEndCount: number = 0;
private adShowFrequency: number = 3; // 每3次显示一次

private shouldShowAd(): boolean {
    this.gameEndCount++;
    return this.gameEndCount % this.adShowFrequency === 0;
}

// 在事件监听中使用
Main.RegistEvent("game_win", (x) => {
    if (this.shouldShowAd()) {
        this.showInterstitialAd();
    }
});
```

### 添加用户设置
可以添加用户设置来控制是否显示广告：

```typescript
public showInterstitialAd() {
    // 检查用户是否关闭了广告
    const adEnabled = PlayerPrefb.getInt("ad_enabled", 1);
    if (adEnabled === 0) {
        console.log("用户已关闭广告");
        return;
    }
    
    // 原有显示逻辑...
}
```

## 故障排除

1. **广告不显示**：
   - 检查控制台日志
   - 确认是否在字节跳动环境中运行
   - 验证广告位ID是否正确

2. **加载失败**：
   - 检查网络连接
   - 确认广告位ID有效
   - 查看字节跳动开发者后台配置

3. **重复显示问题**：
   - 确保只添加了一个 `InterstitialAdManager` 组件
   - 检查事件监听是否重复注册

## 联系支持
如有技术问题，请检查：
1. Cocos Creator 版本兼容性
2. 字节跳动小程序SDK版本
3. 广告位配置是否正确