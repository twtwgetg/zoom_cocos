# 连线问题修复说明

## 问题描述
在连连看游戏中，当玩家点击两个相同的图标进行连接时，系统会显示连接路径的连线动画。但之前存在一个问题：连线在连接点处会出现"出头"现象，即连线超出了目标点的位置。

## 问题原因
1. 连线预制体的锚点设置不正确
2. 连线位置和长度计算不准确
3. 坐标转换逻辑存在偏差

## 解决方案

### 1. 修改连线预制体(line.prefab)
- 将锚点设置为(0.5, 0.5)，即中心点
- 设置合适的尺寸(150x10)

### 2. 优化TObject.ts中的连线绘制逻辑
- 精确计算起始点和结束点的世界坐标
- 正确计算线段中点作为节点位置
- 准确计算线段长度和旋转角度
- 使用正确的坐标转换公式

### 3. 关键代码修改

```typescript
// 计算起始点和结束点的世界坐标
// 由于网格坐标是从1开始的，需要减1得到0基坐标
// 然后根据tref计算实际位置，注意要加上gridsize/2来对齐到网格中心
let startPos = this.creator.tref.add(new Vec2((p.x - 1) * this.creator.gridsize + this.creator.gridsize/2, 
                                             (p.y - 1) * this.creator.gridsize + this.creator.gridsize/2));
let endPos = this.creator.tref.add(new Vec2((p2.x - 1) * this.creator.gridsize + this.creator.gridsize/2, 
                                           (p2.y - 1) * this.creator.gridsize + this.creator.gridsize/2));

// 计算线段的中点作为节点位置
let midPos = new Vec2((startPos.x + endPos.x) / 2, (startPos.y + endPos.y) / 2);
l.setPosition(midPos.x, midPos.y);

// 计算线段的长度
const deltaX = endPos.x - startPos.x;
const deltaY = endPos.y - startPos.y;
const length = Math.sqrt(deltaX * deltaX + deltaY * deltaY);

// 设置缩放，x轴为长度，y轴保持不变
const scaleX = length / 150;
l.setScale(new Vec3(scaleX, 1, 1));

// 计算旋转角度
const angle = Math.atan2(deltaY, deltaX) * 180 / Math.PI;
l.angle = -angle;
```

## 测试方法
1. 打开游戏并进入关卡
2. 寻找两个相同且可以连接的图标
3. 点击第一个图标，再点击第二个图标
4. 观察连线动画是否精确地连接两个图标中心，没有出头现象

## 预期效果
- 连线精确地从一个图标的中心连接到另一个图标的中心
- 连线不会超出图标范围
- 连线的长度和角度准确反映两点间的实际距离和方向
- 连线动画流畅自然